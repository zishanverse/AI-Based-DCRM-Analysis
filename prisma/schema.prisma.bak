generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Station {
  id          String    @id @default(cuid()) @map("station_id")
  name        String
  location    String?
  description String?
  password    String?   @default("$2b$12$cq1...") @map("password_hash") // Default hash for 'password'
  role        String    @default("engineer")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  breakers    Breaker[]

  @@map("stations")
}

model TestResult {
  id                String   @id @default(cuid())
  breakerId         String
  testDate          DateTime @default(now())
  testType          String   @default("DCRM")
  operator          String?
  notes             String?
  fileName          String
  fileUrl           String?
  referenceFileName String?
  referenceFileUrl  String?
  testData          Json
  travelT1Max       Float?
  velocityT1Max     Float?
  resistanceCH1Avg  Float?
  status            String   @default("COMPLETED")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  componentHealth   Json?
  breaker           Breaker  @relation(fields: [breakerId], references: [id], onDelete: Cascade)

  @@index([breakerId, testDate])
  @@map("test_results")
}

model Breaker {
  id               String             @id @default(cuid())
  name             String
  type             String
  manufacturer     String
  model            String?
  voltage          Float?
  current          Float?
  status           String?
  installationDate DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  stationId        String
  dataSourceId     String?
  components       BreakerComponent[]
  dataSource       DataSource?        @relation(fields: [dataSourceId], references: [id])
  station          Station            @relation(fields: [stationId], references: [id], onDelete: Cascade)
  testResults      TestResult[]

  @@map("breakers")
}

model BreakerComponent {
  id          String   @id @default(cuid())
  name        String
  type        String
  description String?
  partNumber  String?
  status      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  breakerId   String
  breaker     Breaker  @relation(fields: [breakerId], references: [id], onDelete: Cascade)

  @@map("breaker_components")
}

model DataSource {
  id          String    @id @default(cuid())
  fileName    String
  fileUrl     String    @unique
  description String?
  status      String    @default("PENDING")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  breakers    Breaker[]

  @@map("data_sources")
}
